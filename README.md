Flask-SocketAPI
===============

Lightweight library to create streaming API over Flask-SocketIO.

Installation
------------

You can download and unzip the latest version of this package from github: [https://github.com/kyouko-taiga/Flask-SocketAPI/archive/master.zip](https://github.com/kyouko-taiga/Flask-SocketAPI/archive/master.zip).

Alternatively, if you have git installed on your system, you may prefer cloning the repository directly:

	git clone https://github.com/kyouko-taiga/Flask-SocketAPI.git

Then, simply navigate to the root directory of the package and run:

	python setup.py install

API protocol
------------

The protocol of the API generated by Flask-SocketAPI is defined as follows:

All resources are identified by special endpoint called URI.
Those are of the form `<name>/<identifier>` where `name` is the name of the resource, and `identifier` is a unique identifier.
List of resources also ave URIs.
Those end with a forward slash and don't include any resource identifier.
All messages use those URIs to identify what resource is concerned.

A client can patch a resource with a `patch` event, which should be sent with a description of the attributes it wants to patch.

```javascript
socket.emit('patch', {
    uri: <resource>/<identifier>,
    patch: {
        <attribute 1>: <patch 1>,
        <attribute 2>: <patch 2>,
        ...
    }
})
```

A client can create a resource with a `create` event.

```javascript
socket.emit('create', {
    uri: <resource>/,
    attributes: {
        <attribute 1>: <value 1>,
        <attribute 2>: <value 2>,
        ...
    }
})
```

A client can delete a resource with a `delete` event.

```javascript
socket.emit('delete', {
    uri: <resource>/<identifier>
})
```

A client can subscribe to all modification of a resource with a `subscribe` event.

```javascript
socket.emit('subscribe', <uri>);
```

A client can unsubscribe from a resource with a `unsubscribe` event..

```javascript
socket.emit('unsubscribe', <uri>);
```

Once the client subscribed to a resource, the server will send it a `state` event with the current state of the subscribed resource.
After that, it will forward any `patch`, `create` and `delete` events that it receives until the client unsubscribes.

Usage
-----

Flask-SocketAPI relies on two things to expose the API.

1. A store interface to save and retreive the exposed resources.
2. A scheme that defines what attributes to use as resource identifiers.

All stores should implement `AbstractStore` so as to ensure they are compatible with the `SocketAPI` object.
This abstract class defines 4 methods to respectively to be implemented as an interface to the backend of your choice.

The scheme defining the identifier attributes is created by calling `add_subscribable(class, attribute)` where `class` is the class of the resource to be exposed and `attribute` is the name of the identifier attribute.

Here is an example of API definition:

```python
from flask import Flask, render_template, json

from flask_socketio import SocketIO
from flask_socketapi import SocketAPI
from flask_socketapi.stores import SimpleStore

from todo import Todo, TodoEncoder

app = Flask(__name__)
app.config['SECRET_KEY'] = 'secret!'
app.json_encoder = TodoEncoder

socketio = SocketIO(app, json=json)
socketapi = SocketAPI(
	socketio=socketio, store=SimpleStore([(Todo, 'id')]))
socketapi.add_subscribable(Todo, 'id')
```

Note that `SimpleStore` is a simple implementation of a store that keeps everything in memory.
It is entended for development purpose and should not be used in production.

Examples
--------

You can check fully working examples in the `examples/` directory.
